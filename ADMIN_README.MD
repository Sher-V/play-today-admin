# Админская документация

## Структура данных клуба и слотов (Firestore)

Используется для клуба в Воронеже (и при необходимости в других городах). Свободные слоты вычисляются по кортам и броням: временные окна без броней считаются свободными.

### Иерархия коллекций

```
clubs                          — коллекция клубов
  {clubId}                     — документ клуба
    courts                     — подколлекция кортов
      {courtId}                 — документ корта
    bookings                   — подколлекция броней
      {bookingId}               — документ брони
    clients                     — подколлекция клиентов (ФИО для подсказки в форме брони)
      {clientId}                — документ клиента
```

### Документ клуба (Club)

Путь: `clubs/{clubId}`

| Поле        | Тип     | Описание                                      |
|-------------|---------|-----------------------------------------------|
| id          | string  | Идентификатор клуба                           |
| name        | string  | Название клуба                                |
| city        | string  | Город (например `voronezh`, см. `constants/cities`) |
| courtOrder  | string[]| (опц.) Порядок кортов для отображения         |
| pricing     | object  | (опц.) Прайс клуба для расчёта суммы брони — см. «Прайс (pricing)» ниже |
| createdAt   | Date    | (опц.) Дата создания                          |
| updatedAt   | Date    | (опц.) Дата обновления                        |

### Документ корта (Court)

Путь: `clubs/{clubId}/courts/{courtId}`

| Поле      | Тип    | Описание                                      |
|-----------|--------|-----------------------------------------------|
| id        | string | Идентификатор корта                            |
| name      | string | Название корта                                 |
| order     | number | (опц.) Порядок в списке кортов (меньше = выше) |
| pricing   | object | (опц.) Прайс корта для расчёта суммы брони — см. «Прайс (pricing)» ниже. Если не задан, используется прайс клуба. |
| createdAt | Date   | (опц.) Дата создания                           |
| updatedAt | Date   | (опц.) Дата обновления                         |

### Прайс (pricing)

Поле `pricing` задаёт цены за аренду для расчёта суммы при создании брони (разовая бронь, «Сгенерировать ссылку на оплату»). Может храниться в документе клуба (`clubs/{clubId}.pricing`) и/или в документе корта (`clubs/{clubId}/courts/{courtId}.pricing`). При расчёте используется прайс корта; если у корта прайса нет — берётся прайс клуба.

Формат:

```json
{
  "weekday": [
    { "startTime": "08:00", "endTime": "22:00", "priceRub": 1500 }
  ],
  "weekend": [
    { "startTime": "08:00", "endTime": "22:00", "priceRub": 2000 }
  ]
}
```

- **weekday** — слоты для будних дней (Пн–Пт). Цена в рублях за час (`priceRub`) для диапазона `startTime`–`endTime` (формат `HH:mm`).
- **weekend** — слоты для выходных (Сб–Вс).
- Можно задать несколько слотов с разными ценами по времени (например, утро/вечер).

### Документ клиента (Client)

Путь: `clubs/{clubId}/clients/{clientId}`

Справочник ФИО клиентов клуба. Используется для подсказки в форме бронирования (поле «Клиент»). При сохранении брони с указанным ФИО клиент автоматически добавляется в подколлекцию, если такого имени ещё нет.

| Поле      | Тип    | Описание |
|-----------|--------|----------|
| id        | string | Идентификатор документа |
| name      | string | ФИО клиента |
| createdAt | Date   | (опц.) Дата создания |
| updatedAt | Date   | (опц.) Дата обновления |

### Документ брони (ClubBooking)

Путь: `clubs/{clubId}/bookings/{bookingId}`

| Поле             | Тип       | Описание |
|-------------------|------------|----------|
| id                | string     | Идентификатор брони |
| courtId           | string     | ID корта в этом клубе (документ из подколлекции `courts`) |
| type              | BookingType| Тип брони: см. ниже |
| startTime         | Timestamp  | Время начала брони |
| endTime           | Timestamp  | Время окончания брони |
| comment           | string     | Комментарий к брони |
| clientId          | string     | (опц.) ID документа клиента в подколлекции `clubs/{clubId}/clients` — связь брони с клиентом. |
| clientName        | string     | (опц.) ФИО клиента (для отображения, дублируется из справочника). В форме при вводе показываются подсказки по справочнику клиентов (поиск по вводу). |
| coach             | string     | (опц.) Тренер — для типов `group` и `personal_training` |
| firstSessionDate  | Timestamp \| null | Дата первого занятия в серии. Для типов `regular`, `group` и `personal_training` (регулярная серия) — обязательно |
| lastSessionDate   | Timestamp \| null | Дата последнего занятия в серии. Для типов `regular`, `group` и `personal_training` (регулярная серия) — обязательно |
| createdAt         | Date       | (опц.) Дата создания |
| updatedAt         | Date       | (опц.) Дата обновления |

### Типы бронирований (BookingType)

| Значение           | Подпись                 | Примечание |
|--------------------|-------------------------|------------|
| one_time           | Разовая                 | Одно занятие, firstSessionDate/lastSessionDate можно не заполнять |
| group              | Группа                  | Серия занятий: заполнять firstSessionDate и lastSessionDate |
| regular            | Регулярная              | Серия занятий: заполнять firstSessionDate и lastSessionDate |
| tournament         | Турнир                  | Турнир, firstSessionDate/lastSessionDate по необходимости |
| personal_training   | Персональная тренировка | Может быть разовой (одно занятие) или регулярной (серия). Поле тренера (coach) обязательно. firstSessionDate/lastSessionDate — для регулярной серии |

Для типов `regular`, `group` и регулярной `personal_training` в Firestore хранятся даты первого и последнего занятия серии (как `Timestamp`).

### Составные индексы Firestore

Для подколлекции `bookings` (`clubs/{clubId}/bookings`) рекомендуется создать индексы:

1. **Все брони корта за период**  
   - `courtId` (Ascending), `startTime` (Ascending)

2. **Все брони за день**  
   - `startTime` (Ascending), `courtId` (Ascending)

Создание: Firebase Console → Firestore → Indexes или через `firestore.indexes.json`.

### Код

Типы и константы: `src/types/club-slots.ts`.
